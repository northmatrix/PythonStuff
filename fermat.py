import math


def fermat_factor(n):
    """Attempts to factor n using Fermat's method. Assumes n = p * q where p â‰ˆ q."""
    a = math.isqrt(n)
    if a * a < n:
        a += 1  # round up to the ceiling of sqrt(n)

    b2 = a * a - n
    while not is_perfect_square(b2):
        a += 1
        b2 = a * a - n

    b = math.isqrt(b2)
    p = a - b
    q = a + b
    return p, q


def is_perfect_square(k):
    s = math.isqrt(k)
    return s * s == k


# Example usage
n = 16175687379152629047346521491934479904887850994872489048643360061820333384984180449778597050824979041995116634323814667721411129837005830475435987312401616746990193104381009089720980002851975849907951122404320588558966195520467578025641530075090072319701961360325892240413638295210828299433493956373561279223591559094452527115679051797668641052937339033596054558495396367796894302673098180871653554012743177298281708198962993550771987830563887791333539393125402891023299292091130454556275914360953332989527809357493906841659349346127890080048528707991045826950690987648181689631942240101752947420604788820788053341237
p, q = fermat_factor(n)
print(f"p = {p}")
print(f"q = {q}")
print(f"Check: p * q = {p * q} (should equal n)")
